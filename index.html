<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Biglietto d'Amore - San Valentino</title>
  <!-- Google Fonts per uno stile moderno -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
  <!-- GSAP per animazioni fluide -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.1/gsap.min.js"></script>
  <style>
    /* ====== STILI GLOBALI ====== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      overflow: hidden;
      width: 100%;
      height: 100vh;
      background: #000;
      position: relative;
    }
    .screen {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
    }
    /* ====== SCREEN 1: BACKGROUND SWIRL E CUORE INIZIALE ====== */
    #screen1 { background: #000; }
    .swirl {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: radial-gradient(circle at center, #ff9a9e, #fad0c4);
      animation: swirl 12s linear infinite;
      z-index: -1;
    }
    @keyframes swirl {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    #heartContainer {
      cursor: pointer;
      z-index: 1;
    }
    #mainHeart {
      width: 150px;
      height: 150px;
    }
    .startText {
      margin-top: 20px;
      font-size: 1.2em;
      color: #fff;
      opacity: 0.8;
    }
    /* Frammenti del cuore (generati al tocco) */
    .heartFragment {
      position: absolute;
      pointer-events: none;
    }
    /* ====== SCREEN 2: MESSAGGIO CON EFFETTO TYPEWRITER ====== */
    #screen2 { background: linear-gradient(135deg, #8e44ad, #3498db); }
    .typewriter {
      font-size: 1.5em;
      max-width: 90%;
      color: #fff;
      border-right: 2px solid rgba(255,255,255,0.75);
      white-space: nowrap;
      overflow: hidden;
    }
    /* ====== SCREEN 3: FINALE CON MESSAGGIO E SPARKLES ====== */
    #screen3 { background: linear-gradient(135deg, #ff758c, #ff7eb3); }
    .finalMessage {
      font-size: 2em;
      color: #fff;
      margin-bottom: 20px;
    }
    .sparkle {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(circle, #fff, #ffd700);
      border-radius: 50%;
      opacity: 0;
    }
  </style>
</head>
<body>
  <!-- ====== SCREEN 1: CUORE INIZIALE CON BACKGROUND SWIRL ====== -->
  <div id="screen1" class="screen">
    <div class="swirl"></div>
    <div id="heartContainer">
      <svg id="mainHeart" viewBox="0 0 32 29.6">
        <path d="M23.6,0c-2.6,0-5,1.1-6.6,2.9C15.4,1.1,13,0,10.4,0C4.7,0,0,4.7,0,10.4c0,7.8,7.2,13.9,18,19.2l1.3,0.7
          l1.3-0.7c10.8-5.3,18-11.4,18-19.2C32,4.7,27.3,0,23.6,0z" fill="#FF6F61"/>
      </svg>
    </div>
    <div class="startText">Tocca per iniziare</div>
  </div>

  <!-- ====== SCREEN 2: MESSAGGIO CON EFFETTO TYPEWRITER ====== -->
  <div id="screen2" class="screen" style="display: none;">
    <div id="typewriterText" class="typewriter"></div>
  </div>

  <!-- ====== SCREEN 3: FINALE CON MESSAGGIO E SPARKLES ====== -->
  <div id="screen3" class="screen" style="display: none;">
    <div class="finalMessage" id="finalMessage">Ti amo, ogni battito è per te</div>
    <div id="sparklesContainer"></div>
  </div>

  <script>
    /* Funzione typewriter per scrivere i testi lettera per lettera */
    function typeWriter(element, text, speed, callback) {
      let i = 0;
      function type() {
        if(i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
          setTimeout(type, speed);
        } else if(callback) {
          callback();
        }
      }
      type();
    }

    /* ====== SCREEN 1: AL TOCCO, IL CUORE SI FRAMMENTA E TRANSIZIONE A SCREEN 2 ====== */
    document.getElementById("heartContainer").addEventListener("click", function() {
      // Evita click multipli
      if(this.clicked) return;
      this.clicked = true;

      const heart = document.getElementById("mainHeart");
      const heartRect = heart.getBoundingClientRect();
      // Genera 12 frammenti
      for(let i = 0; i < 12; i++){
        let frag = document.createElement("div");
        frag.classList.add("heartFragment");
        // Inserisce l'SVG del cuore
        frag.innerHTML = heart.outerHTML;
        // Posiziona il frammento nello stesso punto del cuore originale
        frag.style.left = heartRect.left + "px";
        frag.style.top = heartRect.top + "px";
        document.body.appendChild(frag);
        // Animazione: ogni frammento esplode in direzioni casuali
        gsap.to(frag, {
          duration: 1,
          x: (Math.random()-0.5)*300,
          y: (Math.random()-0.5)*300,
          rotation: Math.random()*720,
          opacity: 0,
          ease: "power2.out",
          delay: 0.1
        });
      }
      // Sfuma il cuore originale
      gsap.to("#heartContainer", {duration: 0.5, opacity: 0});
      // Dopo l'esplosione, transizione a Screen 2
      gsap.to("#screen1", {
        duration: 0.5, 
        opacity: 0, 
        delay: 1.2,
        onComplete: function(){
          document.getElementById("screen1").style.display = "none";
          document.getElementById("screen2").style.display = "flex";
          gsap.fromTo("#screen2", {opacity: 0}, {duration: 0.5, opacity: 1});
          startTypewriter();
        }
      });
    });

    /* ====== SCREEN 2: MESSAGGIO CON EFFETTO TYPEWRITER ====== */
    function startTypewriter(){
      const textElem = document.getElementById("typewriterText");
      const message = "L'amore è un viaggio straordinario, un'onda di emozioni che trasforma ogni istante in magia. Lascia che il tuo cuore segua questa melodia...";
      typeWriter(textElem, message, 40, function(){
        // Al termine, attendi un attimo e passa alla schermata finale
        setTimeout(transitionToFinal, 1500);
      });
    }

    function transitionToFinal(){
      gsap.to("#screen2", {
        duration: 0.5,
        opacity: 0,
        onComplete: function(){
          document.getElementById("screen2").style.display = "none";
          document.getElementById("screen3").style.display = "flex";
          gsap.fromTo("#screen3", {opacity: 0}, {duration: 0.5, opacity: 1});
          createSparkles();
        }
      });
    }

    /* ====== SCREEN 3: CREAZIONE DELL'EFFETTO "SPARKLES" ====== */
    function createSparkles(){
      const container = document.getElementById("sparklesContainer");
      const sparkleCount = 30;
      for(let i = 0; i < sparkleCount; i++){
        let sparkle = document.createElement("div");
        sparkle.classList.add("sparkle");
        // Posizionamento casuale sullo schermo
        sparkle.style.left = Math.random() * window.innerWidth + "px";
        sparkle.style.top = Math.random() * window.innerHeight + "px";
        container.appendChild(sparkle);
        // Animazione: il "sparkle" si illumina, sale e poi svanisce, in loop
        gsap.to(sparkle, {
          duration: 1 + Math.random(),
          y: -100 - Math.random()*200,
          opacity: 1,
          ease: "power2.out",
          yoyo: true,
          repeat: -1,
          delay: Math.random()
        });
      }
    }

    // Opzionale: al tocco sullo schermo finale, genera ulteriori "sparkles" e vibra per dare più impatto
    document.getElementById("screen3").addEventListener("click", function(){
      createSparkles();
      if(navigator.vibrate) navigator.vibrate(50);
    });
  </script>
</body>
</html>
